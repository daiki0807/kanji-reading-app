<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Êº¢Â≠óË™≠„ÅøÁ∑¥Áøí„Ç¢„Éó„É™</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', 'Inter', sans-serif;
            overscroll-behavior: none; /* Prevents pull-to-refresh on mobile */
        }
        .kanji-display {
            font-size: 7rem; /* Default large size for Kanji */
            line-height: 1.2; /* Adjusted for longer strings */
            text-align: center;
            margin-bottom: 1rem;
            color: #333;
            min-height: 112px; /* Ensure space for Kanji (7rem approx) */
            display: flex;
            align-items: center;
            justify-content: center;
            padding-left: 0.5rem; /* Added padding for longer text */
            padding-right: 0.5rem;
            overflow-wrap: break-word; /* Allow breaking long words if necessary */
            word-break: keep-all; /* Try to keep words together for Japanese */
        }
        /* Responsive font size for Kanji */
        @media (max-width: 768px) { /* md */
            .kanji-display {
                font-size: 6rem;
                min-height: 96px; /* 6rem approx */
            }
        }
        @media (max-width: 640px) { /* sm */
            .kanji-display {
                font-size: 4.5rem; /* Further reduced for small screens */
                min-height: 72px; /* 4.5rem approx */
            }
        }
        .feedback-correct {
            color: #16a34a; /* green-600 */
            font-weight: bold;
        }
        .feedback-incorrect {
            color: #dc2626; /* red-600 */
            font-weight: bold;
        }
        .btn {
            transition: all 0.2s ease-in-out;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .btn:active {
            transform: translateY(0px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        /* Custom focus style for accessibility */
        input[type="text"]:focus, button:focus {
            outline: 2px solid transparent;
            outline-offset: 2px;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5); /* Tailwind blue-500 focus ring */
        }
        /* Basic modal style */
        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 0.5rem;
            text-align: center;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-sky-100 to-blue-200 min-h-screen flex flex-col items-center justify-center p-4 selection:bg-sky-300 selection:text-sky-900">

    <div id="app-container" class="bg-white p-6 sm:p-8 rounded-xl shadow-2xl w-full max-w-lg text-gray-700">

        <div id="settings-screen">
            <h1 class="text-3xl sm:text-4xl font-bold text-center text-sky-600 mb-8">Êº¢Â≠óË™≠„ÅøÁ∑¥Áøí</h1>
            <p class="text-center mb-2 text-lg">„Åå„Åè„Å≠„Çì„Çí „Åà„Çâ„Çì„Åß„Å≠ÔºÅ</p>
            <div class="space-y-4">
                <button id="grade1-btn" class="btn w-full bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 px-4 rounded-lg text-xl shadow-md">
                    1Âπ¥Áîü„ÅÆ„Åã„Çì„Åò
                </button>
                <button id="grade2-btn" class="btn w-full bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-4 rounded-lg text-xl shadow-md">
                    2Âπ¥Áîü„ÅÆ„Åã„Çì„Åò
                </button>
                <button id="grade-all-btn" class="btn w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg text-xl shadow-md">
                    1„Éª2Âπ¥Áîü„Åú„Çì„Å∂
                </button>
            </div>
        </div>

        <div id="quiz-screen" style="display:none;">
            <div class="flex justify-between items-center mb-4">
                <h2 id="quiz-title" class="text-2xl font-bold text-sky-700">„Çà„Åø„Åã„Åü„ÇØ„Ç§„Ç∫ÔºÅ</h2>
                <button id="back-to-settings-btn" class="btn bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-3 rounded-md text-sm">
                    „ÇÇ„Å©„Çã
                </button>
            </div>
            <div id="progress-bar-container" class="w-full bg-gray-200 rounded-full h-2.5 mb-4 dark:bg-gray-700">
                <div id="progress-bar" class="bg-blue-500 h-2.5 rounded-full" style="width: 0%"></div>
            </div>
            <div id="kanji-display" class="kanji-display select-none"></div>
            <input type="text" id="reading-input" placeholder="„Å≤„Çâ„Åå„Å™„Åß „ÅÑ„Çå„Å¶„Å≠"
                   class="w-full p-3 border-2 border-sky-300 rounded-lg text-xl text-center mb-4 focus:border-sky-500 focus:ring-sky-500"
                   autocorrect="off" autocapitalize="none" spellcheck="false">
            <button id="check-button" class="btn w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg text-xl mb-2 shadow-md">
                „Åì„Åü„Åà„ÅÇ„Çè„Åõ
            </button>
            <button id="next-button" style="display:none;" class="btn w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-4 rounded-lg text-xl mb-2 shadow-md">
                „Å§„Åé„Å∏
            </button>
            <div id="feedback-message" class="text-center text-lg min-h-[2.5em] mt-2 mb-2"></div>
            <div id="score-display" class="text-center text-lg font-semibold text-gray-600"></div>
        </div>

        <div id="results-screen" style="display:none;">
            <h2 class="text-3xl font-bold text-center text-sky-600 mb-6">„Åë„Å£„Åã „ÅØ„Å£„Å¥„Çá„ÅÜÔºÅ</h2>
            <div id="final-score" class="text-center text-5xl font-bold text-yellow-500 mb-4"></div>
            <div id="final-message" class="text-center text-xl mb-8"></div>
            <div class="space-y-3">
                <button id="restart-quiz-btn" class="btn w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg text-lg shadow-md">
                    „ÇÇ„ÅÜ„ÅÑ„Å°„Å©„ÉÅ„É£„É¨„É≥„Ç∏ÔºÅ
                </button>
                <button id="change-grade-btn" class="btn w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg text-lg shadow-md">
                    „Åå„Åè„Å≠„Çì„Çí „Åã„Åà„Çã
                </button>
            </div>
        </div>
    </div>

    <div id="custom-message-modal" class="modal">
        <div class="modal-content">
            <p id="modal-text" class="text-lg mb-4"></p>
            <button id="modal-ok-button" class="btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg">OK</button>
        </div>
    </div>


    <script>
        // Êº¢Â≠ó„Éá„Éº„Çø
        // display: Ë°®Á§∫„Åô„ÇãÊñáÂ≠óÂàó (ÈÄÅ„Çä‰ªÆÂêçËæº„Åø)
        // readings: Ê≠£„Åó„ÅÑË™≠„Åø„ÅÆÈÖçÂàó („Å≤„Çâ„Åå„Å™)
        const kanjiData = {
            g1: [
                { display: "‰∏Ä", readings: ["„ÅÑ„Å°"] },
                { display: "Âè≥", readings: ["„Åø„Åé"] },
                { display: "Èõ®", readings: ["„ÅÇ„ÇÅ"] },
                { display: "ÂÜÜ", readings: ["„Åà„Çì"] }, // „Äå„Åæ„Çã„ÅÑ„Äç„ÅØÂΩ¢ÂÆπË©û„Å™„ÅÆ„ÅßÂà•ÈÄîÂïèÈ°å„Å´„Åô„Çã„ÅãÊ§úË®é
                { display: "Áéã„Åï„Åæ", readings: ["„Åä„ÅÜ„Åï„Åæ"] }, // „ÄåÁéã„ÄçÂçò‰Ωì„ÇÇÂà•ÈÄî
                { display: "Èü≥", readings: ["„Åä„Å®", "„Åä„Çì"] },
                { display: "‰∏ã", readings: ["„Åó„Åü", "„Åó„ÇÇ", "„ÇÇ„Å®"] },
                { display: "‰∏ã„Åå„Çã", readings: ["„Åï„Åå„Çã"] },
                { display: "‰∏ã„Çã", readings: ["„Åè„Å†„Çã"] },
                { display: "‰∏ã„Çç„Åô", readings: ["„Åä„Çç„Åô"] },
                { display: "ÁÅ´", readings: ["„Å≤", "„Åã", "„Åª"] },
                { display: "Ëä±", readings: ["„ÅØ„Å™", "„Åã"] },
                { display: "Â≠¶„Å∂", readings: ["„Åæ„Å™„Å∂"] },
                { display: "Â≠¶Ê†°", readings: ["„Åå„Å£„Åì„ÅÜ"] }, // „ÄåÂ≠¶„ÄçÂçò‰Ωì„ÇÇ
                { display: "Ê∞ó", readings: ["„Åç", "„Åë"] }, // „ÄåÂÖÉÊ∞ó„Äç„ÄåÂ§©Ê∞ó„Äç„ÅØÁÜüË™û
                { display: "‰πù", readings: ["„Åç„ÇÖ„ÅÜ", "„Åè"] },
                { display: "‰πù„Å§", readings: ["„Åì„Åì„ÅÆ„Å§"] },
                { display: "Á©∫", readings: ["„Åù„Çâ", "„Åè„ÅÜ"] },
                { display: "Á©∫„Åè", readings: ["„ÅÇ„Åè"] },
                { display: "Á©∫„Åë„Çã", readings: ["„ÅÇ„Åë„Çã"] },
                { display: "Áä¨", readings: ["„ÅÑ„Å¨", "„Åë„Çì"] },
                { display: "Ë¶ã„Çã", readings: ["„Åø„Çã"] },
                { display: "Ë¶ã„Åà„Çã", readings: ["„Åø„Åà„Çã"] },
                { display: "Ë¶ã„Åõ„Çã", readings: ["„Åø„Åõ„Çã"] },
                { display: "‰∫î", readings: ["„Åî"] },
                { display: "‰∫î„Å§", readings: ["„ÅÑ„Å§„Å§"] },
                { display: "Âè£", readings: ["„Åè„Å°", "„Åì„ÅÜ", "„Åè"] },
                { display: "Ê†°", readings: ["„Åì„ÅÜ", "„Åç„Çá„ÅÜ"] }, // „ÄåÂ≠¶Ê†°„Äç„Åß‰ΩøÁî®
                { display: "Â∑¶", readings: ["„Å≤„Å†„Çä", "„Åï"] },
                { display: "‰∏â", readings: ["„Åï„Çì", "„Åø"] },
                { display: "‰∏â„Å§", readings: ["„Åø„Å£„Å§"] },
                { display: "Â±±", readings: ["„ÇÑ„Åæ", "„Åï„Çì", "„Åõ„Çì"] },
                { display: "Â≠ê„Å©„ÇÇ", readings: ["„Åì„Å©„ÇÇ"] }, // „ÄåÂ≠ê„ÄçÂçò‰Ωì„ÇÇ
                { display: "Âõõ", readings: ["„Åó", "„Çà„Çì"] },
                { display: "Âõõ„Å§", readings: ["„Çà„Å£„Å§"] },
                { display: "Á≥∏", readings: ["„ÅÑ„Å®", "„Åó"] },
                { display: "Â≠ó", readings: ["„Åò"] }, // „ÄåÊñáÂ≠ó„Äç„ÅØÁÜüË™û
                { display: "ËÄ≥", readings: ["„Åø„Åø", "„Åò"] },
                { display: "‰∏É", readings: ["„Åó„Å°", "„Å™„Å™"] },
                { display: "‰∏É„Å§", readings: ["„Å™„Å™„Å§"] },
                { display: "Ëªä", readings: ["„Åè„Çã„Åæ", "„Åó„ÇÉ"] },
                { display: "Êâã", readings: ["„Å¶", "„Åü", "„Åó„ÇÖ"] },
                { display: "ÂçÅ", readings: ["„Åò„ÇÖ„ÅÜ", "„Å®„Åä", "„Å®"] },
                { display: "Âá∫„Çã", readings: ["„Åß„Çã"] },
                { display: "Âá∫„Åô", readings: ["„Å†„Åô"] },
                { display: "Â•≥", readings: ["„Åä„Çì„Å™", "„ÇÅ", "„Åò„Çá"] },
                { display: "Â∞è„Åï„ÅÑ", readings: ["„Å°„ÅÑ„Åï„ÅÑ"] },
                { display: "Â∞èÂ∑ù", readings: ["„Åä„Åå„Çè"] }, // „ÄåÂ∞è„ÄçÂçò‰Ωì„ÇÇ
                { display: "‰∏ä", readings: ["„ÅÜ„Åà", "„ÅÜ„Çè", "„Åã„Åø", "„Åò„Çá„ÅÜ", "„Åó„Çá„ÅÜ"] },
                { display: "‰∏ä„Åå„Çã", readings: ["„ÅÇ„Åå„Çã"] },
                { display: "‰∏ä„Åí„Çã", readings: ["„ÅÇ„Åí„Çã"] },
                { display: "‰∏ä„Çã", readings: ["„ÅÆ„Åº„Çã"] },
                { display: "Ê£Æ", readings: ["„ÇÇ„Çä", "„Åó„Çì"] },
                { display: "‰∫∫", readings: ["„Å≤„Å®", "„Åò„Çì", "„Å´„Çì"] },
                { display: "Ê∞¥", readings: ["„Åø„Åö", "„Åô„ÅÑ"] },
                { display: "Ê≠£„Åó„ÅÑ", readings: ["„Åü„Å†„Åó„ÅÑ"] },
                { display: "Ê≠£„Åô", readings: ["„Åü„Å†„Åô"] },
                { display: "Áîü„Åç„Çã", readings: ["„ÅÑ„Åç„Çã"] },
                { display: "Áîü„Åæ„Çå„Çã", readings: ["„ÅÜ„Åæ„Çå„Çã"] },
                { display: "Áîü„ÇÄ", readings: ["„ÅÜ„ÇÄ"] },
                { display: "Áîü„Åà„Çã", readings: ["„ÅØ„Åà„Çã"] },
                { display: "Èùí„ÅÑ", readings: ["„ÅÇ„Åä„ÅÑ"] },
                { display: "ÈùíÁ©∫", readings: ["„ÅÇ„Åä„Åû„Çâ"] },
                { display: "Áü≥", readings: ["„ÅÑ„Åó", "„Åõ„Åç", "„Åì„Åè"] },
                { display: "Ëµ§„ÅÑ", readings: ["„ÅÇ„Åã„ÅÑ"] },
                { display: "Ëµ§„Çâ„ÇÄ", readings: ["„ÅÇ„Åã„Çâ„ÇÄ"] },
                { display: "ÂçÉ", readings: ["„Å°", "„Åõ„Çì"] },
                { display: "Â∑ù", readings: ["„Åã„Çè", "„Åõ„Çì"] },
                { display: "ÂÖà", readings: ["„Åï„Åç", "„Åõ„Çì"] }, // „ÄåÂÖàÁîü„Äç„ÅØÁÜüË™û
                { display: "Êó©„ÅÑ", readings: ["„ÅØ„ÇÑ„ÅÑ"] },
                { display: "Êó©„Åæ„Çã", readings: ["„ÅØ„ÇÑ„Åæ„Çã"] },
                { display: "Ëçâ", readings: ["„Åè„Åï", "„Åù„ÅÜ"] },
                { display: "Ë∂≥", readings: ["„ÅÇ„Åó", "„Åù„Åè"] },
                { display: "Ë∂≥„Çä„Çã", readings: ["„Åü„Çä„Çã"] },
                { display: "Êùë", readings: ["„ÇÄ„Çâ", "„Åù„Çì"] },
                { display: "Â§ß„Åç„ÅÑ", readings: ["„Åä„Åä„Åç„ÅÑ"] },
                { display: "Â§ß‰∫∫", readings: ["„Åä„Å®„Å™"] },
                { display: "Áî∑", readings: ["„Åä„Å®„Åì", "„Å†„Çì", "„Å™„Çì"] },
                { display: "Á´π", readings: ["„Åü„Åë", "„Å°„Åè"] },
                { display: "‰∏≠", readings: ["„Å™„Åã", "„ÅÜ„Å°", "„Å°„ÇÖ„ÅÜ"] },
                { display: "Ëô´", readings: ["„ÇÄ„Åó", "„Å°„ÇÖ„ÅÜ"] },
                { display: "Áî∫", readings: ["„Åæ„Å°", "„Å°„Çá„ÅÜ"] },
                { display: "Â§©", readings: ["„ÅÇ„ÇÅ", "„ÅÇ„Åæ", "„Å¶„Çì"] }, // „ÄåÂ§©Ê∞ó„Äç„ÅØÁÜüË™û
                { display: "Áî∞", readings: ["„Åü", "„Åß„Çì"] },
                { display: "Âúü", readings: ["„Å§„Å°", "„Å®", "„Å©"] },
                { display: "‰∫å", readings: ["„Å´", "„Åµ„Åü"] },
                { display: "‰∫å„Å§", readings: ["„Åµ„Åü„Å§"] },
                { display: "Êó•", readings: ["„Å≤", "„Åã", "„Å´„Å°", "„Åò„Å§"] }, // „ÄåÊó•ÊõúÊó•„Äç
                { display: "ÂÖ•„Çã", readings: ["„ÅØ„ÅÑ„Çã"] },
                { display: "ÂÖ•„Çå„Çã", readings: ["„ÅÑ„Çå„Çã"] },
                { display: "Âπ¥", readings: ["„Å®„Åó", "„Å≠„Çì"] },
                { display: "ÁôΩ„ÅÑ", readings: ["„Åó„Çç„ÅÑ"] },
                { display: "ÁôΩ", readings: ["„Åó„Çç", "„ÅØ„Åè", "„Å≥„ÇÉ„Åè"] },
                { display: "ÂÖ´", readings: ["„ÇÑ", "„ÅØ„Å°"] },
                { display: "ÂÖ´„Å§", readings: ["„ÇÑ„Å£„Å§"] },
                { display: "Áôæ", readings: ["„ÇÇ„ÇÇ", "„Å≤„ÇÉ„Åè"] },
                { display: "Êñá", readings: ["„Åµ„Åø", "„Å∂„Çì", "„ÇÇ„Çì"] }, // „ÄåÊñáÂ≠ó„Äç
                { display: "Êú®", readings: ["„Åç", "„Åì", "„ÇÇ„Åè", "„Åº„Åè"] },
                { display: "Êú¨", readings: ["„ÇÇ„Å®", "„Åª„Çì"] },
                { display: "Âêç", readings: ["„Å™", "„ÇÅ„ÅÑ", "„Åø„Çá„ÅÜ"] }, // „ÄåÂêçÂâç„Äç
                { display: "ÁõÆ", readings: ["„ÇÅ", "„Åæ", "„ÇÇ„Åè", "„Åº„Åè"] },
                { display: "Á´ã„Å§", readings: ["„Åü„Å§"] },
                { display: "Á´ã„Å¶„Çã", readings: ["„Åü„Å¶„Çã"] },
                { display: "Âäõ", readings: ["„Å°„Åã„Çâ", "„Çä„Åç", "„Çä„Çá„Åè"] },
                { display: "Êûó", readings: ["„ÅØ„ÇÑ„Åó", "„Çä„Çì"] },
                { display: "ÂÖ≠", readings: ["„ÇÄ", "„Çç„Åè"] },
                { display: "ÂÖ≠„Å§", readings: ["„ÇÄ„Å£„Å§"] },
                { display: "Ë©±„Åô", readings: ["„ÅØ„Å™„Åô"] },
                { display: "Ë©±", readings: ["„ÅØ„Å™„Åó", "„Çè"] }
            ],
            g2: [
                { display: "Âºï„Åè", readings: ["„Å≤„Åè"] },
                { display: "ÁæΩ", readings: ["„ÅØ„Å≠", "„ÅØ", "„Çè"] },
                { display: "Èõ≤", readings: ["„Åè„ÇÇ", "„ÅÜ„Çì"] },
                { display: "ÂÖ¨Âúí", readings: ["„Åì„ÅÜ„Åà„Çì"] }, // „ÄåÂúí„ÄçÂçò‰Ωì„ÇÇ
                { display: "ÈÅ†„ÅÑ", readings: ["„Å®„Åä„ÅÑ"] },
                { display: "‰Ωï", readings: ["„Å™„Å´", "„Å™„Çì"] },
                { display: "ÁßëÂ≠¶", readings: ["„Åã„Åå„Åè"] }, //„ÄåÁßë„ÄçÂçò‰Ωì„ÇÇ
                { display: "Â§è", readings: ["„Å™„Å§", "„Åã", "„Åí"] },
                { display: "ÂÆ∂", readings: ["„ÅÑ„Åà", "„ÅÜ„Å°", "„ÇÑ", "„Åã", "„Åë"] },
                { display: "Ê≠å", readings: ["„ÅÜ„Åü", "„Åã"] },
                { display: "Ê≠å„ÅÜ", readings: ["„ÅÜ„Åü„ÅÜ"] },
                { display: "Áîª", readings: ["„Åà", "„Åå", "„Åã„Åè"] }, // „ÄåË®àÁîª„Äç„ÄåÁîªÂÆ∂„Äç
                { display: "Âõû„Çã", readings: ["„Åæ„Çè„Çã"] },
                { display: "Âõû„Åô", readings: ["„Åæ„Çè„Åô"] },
                { display: "‰∏ÄÂõû", readings: ["„ÅÑ„Å£„Åã„ÅÑ"] },
                { display: "‰ºö„ÅÜ", readings: ["„ÅÇ„ÅÜ"] },
                { display: "‰ºöÁ§æ", readings: ["„Åã„ÅÑ„Åó„ÇÉ"] }, // „Äå‰ºö„ÄçÂçò‰Ωì„ÇÇ
                { display: "Êµ∑", readings: ["„ÅÜ„Åø", "„Åã„ÅÑ"] },
                { display: "Áµµ", readings: ["„Åà", "„Åã„ÅÑ"] },
                { display: "Â§ñ", readings: ["„Åù„Å®", "„Åª„Åã", "„Åå„ÅÑ", "„Åí"] },
                { display: "Â§ñ„Åô", readings: ["„ÅØ„Åö„Åô"] },
                { display: "Ëßí", readings: ["„Åã„Å©", "„Å§„ÅÆ", "„Åô„Åø", "„Åã„Åè"] }, // „Äå‰∏âËßí„Äç
                { display: "Ê•Ω„Åó„ÅÑ", readings: ["„Åü„ÅÆ„Åó„ÅÑ"] },
                { display: "Ê•Ω„Åó„ÇÄ", readings: ["„Åü„ÅÆ„Åó„ÇÄ"] },
                { display: "Èü≥Ê•Ω", readings: ["„Åä„Çì„Åå„Åè"] }, // „ÄåÊ•Ω„ÄçÂçò‰Ωì„ÇÇ
                { display: "Ê¥ªÂãï", readings: ["„Åã„Å§„Å©„ÅÜ"] }, // „ÄåÊ¥ª„ÄçÂçò‰Ωì„ÇÇ
                { display: "Èñì", readings: ["„ÅÇ„ÅÑ„Å†", "„Åæ", "„Åã„Çì", "„Åë„Çì"] }, // „ÄåÊôÇÈñì„Äç
                { display: "‰∏∏„ÅÑ", readings: ["„Åæ„Çã„ÅÑ"] },
                { display: "‰∏∏", readings: ["„Åæ„Çã", "„Åå„Çì"] },
                { display: "Â≤©", readings: ["„ÅÑ„Çè", "„Åå„Çì"] },
                { display: "È°î", readings: ["„Åã„Åä", "„Åå„Çì"] },
                { display: "Ê±ΩËªä", readings: ["„Åç„Åó„ÇÉ"] }, // „ÄåÊ±Ω„ÄçÂçò‰Ωì„ÇÇ
                { display: "Ë®ò„Åô", readings: ["„Åó„Çã„Åô"] },
                { display: "Ë®ò‰∫ã", readings: ["„Åç„Åò"] }, // „ÄåË®ò„ÄçÂçò‰Ωì„ÇÇ
                { display: "Â∏∞„Çã", readings: ["„Åã„Åà„Çã"] },
                { display: "Âºì", readings: ["„ÇÜ„Åø", "„Åç„ÇÖ„ÅÜ"] },
                { display: "Áâõ", readings: ["„ÅÜ„Åó", "„Åé„ÇÖ„ÅÜ"] },
                { display: "È≠ö", readings: ["„Åï„Åã„Å™", "„ÅÜ„Åä", "„Åé„Çá"] },
                { display: "Êù±‰∫¨", readings: ["„Å®„ÅÜ„Åç„Çá„ÅÜ"] }, // „Äå‰∫¨„ÄçÂçò‰Ωì„ÇÇ
                { display: "Âº∑„ÅÑ", readings: ["„Å§„Çà„ÅÑ"] },
                { display: "Âº∑„ÅÑ„Çã", readings: ["„Åó„ÅÑ„Çã"] },
                { display: "Êïô„Åà„Çã", readings: ["„Åä„Åó„Åà„Çã"] },
                { display: "Êïô„Çè„Çã", readings: ["„Åä„Åù„Çè„Çã"] },
                { display: "Ëøë„ÅÑ", readings: ["„Å°„Åã„ÅÑ"] },
                { display: "ÂÖÑ", readings: ["„ÅÇ„Å´", "„Åë„ÅÑ", "„Åç„Çá„ÅÜ"] },
                { display: "ÂΩ¢", readings: ["„Åã„Åü„Å°", "„Åã„Åü", "„Å™„Çä", "„Åë„ÅÑ", "„Åé„Çá„ÅÜ"] },
                { display: "Ë®à„Çã", readings: ["„ÅØ„Åã„Çã"] },
                { display: "Ë®àÁÆó", readings: ["„Åë„ÅÑ„Åï„Çì"] }, // „ÄåË®à„ÄçÂçò‰Ωì„ÇÇ
                { display: "ÂÖÉÊ∞ó", readings: ["„Åí„Çì„Åç"] }, // „ÄåÂÖÉ„ÄçÂçò‰Ωì„ÇÇ
                { display: "ËçâÂéü", readings: ["„Åù„ÅÜ„Åí„Çì"] }, // „ÄåÂéü„ÄçÂçò‰Ωì„ÇÇ
                { display: "Êà∏", readings: ["„Å®", "„Åì"] },
                { display: "Âè§„ÅÑ", readings: ["„Åµ„Çã„ÅÑ"] },
                { display: "ÂçàÂâç", readings: ["„Åî„Åú„Çì"] }, // „ÄåÂçà„ÄçÂçò‰Ωì„ÇÇ
                // ... (‰ª•‰∏ã„ÄÅÂêåÊßò„Å´2Âπ¥Áîü„ÅÆÊº¢Â≠ó„Éá„Éº„Çø„ÇíÊï¥ÂÇô)
                { display: "È£ü„Åπ„Çã", readings: ["„Åü„Åπ„Çã"] },
                { display: "Êõ∏„Åè", readings: ["„Åã„Åè"] },
                { display: "ËÅû„Åè", readings: ["„Åç„Åè"] },
                { display: "Ë©±„Åô", readings: ["„ÅØ„Å™„Åô"] }, // 1Âπ¥Áîü„Å´„ÇÇ„ÅÇ„Çã„Åå„ÄÅ2Âπ¥Áîü„ÅÆ„É™„Çπ„Éà„Å´„ÇÇ„ÅÇ„ÇãÊÉ≥ÂÆö
                { display: "Ê≠©„Åè", readings: ["„ÅÇ„Çã„Åè"] },
                { display: "Ëµ∞„Çã", readings: ["„ÅØ„Åó„Çã"] },
                { display: "Â∏∞„Çã", readings: ["„Åã„Åà„Çã"] },
                { display: "Â£≤„Çã", readings: ["„ÅÜ„Çã"] },
                { display: "Ë≤∑„ÅÜ", readings: ["„Åã„ÅÜ"] },
                { display: "Ë™≠„ÇÄ", readings: ["„Çà„ÇÄ"] },
                { display: "‰Ωú„Çã", readings: ["„Å§„Åè„Çã"] },
                { display: "‰Ωø„ÅÜ", readings: ["„Å§„Åã„ÅÜ"] },
                { display: "Áü•„Çã", readings: ["„Åó„Çã"] },
                { display: "ÊåÅ„Å§", readings: ["„ÇÇ„Å§"] },
                { display: "Âàá„Çã", readings: ["„Åç„Çã"] },
                { display: "ÈÄÅ„Çã", readings: ["„Åä„Åè„Çã"] },
                { display: "Á≠î„Åà„Çã", readings: ["„Åì„Åü„Åà„Çã"] },
                { display: "Âßã„Åæ„Çã", readings: ["„ÅØ„Åò„Åæ„Çã"] },
                { display: "ÁµÇ„Çè„Çã", readings: ["„Åä„Çè„Çã"] }, // „ÄåÁµÇ„Äç„ÅØ„É™„Çπ„Éà„Å´„Å™„ÅÑ„Åå‰æã„Å®„Åó„Å¶
                { display: "Êô¥„Çå„Çã", readings: ["„ÅØ„Çå„Çã"] },
                { display: "Êòé„Åã„Çä", readings: ["„ÅÇ„Åã„Çä"] },
                { display: "Êòé„Çã„ÅÑ", readings: ["„ÅÇ„Åã„Çã„ÅÑ"] },
                { display: "È≥¥„Åè", readings: ["„Å™„Åè"] },
                { display: "È≥¥„Çã", readings: ["„Å™„Çã"] }
            ]
        };

        // 1„Éª2Âπ¥Áîü„ÅÆÊº¢Â≠ó„ÇíÁµêÂêà„Åó„ÄÅÈáçË§á„ÇíÂá¶ÁêÜ„Åô„Çã
        const allKanji = [];
        const tempMap = new Map();

        function addOrMergeKanji(kanjiObj) {
            if (tempMap.has(kanjiObj.display)) {
                const existingEntry = tempMap.get(kanjiObj.display);
                kanjiObj.readings.forEach(reading => {
                    if (!existingEntry.readings.includes(reading)) {
                        existingEntry.readings.push(reading);
                    }
                });
            } else {
                // Êñ∞„Åó„ÅÑË™≠„Åø„ÅÆÈÖçÂàó„Åß„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„Çí‰ΩúÊàê„Åó„ÄÅMap„Å´ÁôªÈå≤
                tempMap.set(kanjiObj.display, { ...kanjiObj, readings: [...kanjiObj.readings] });
            }
        }

        kanjiData.g1.forEach(addOrMergeKanji);
        kanjiData.g2.forEach(addOrMergeKanji);

        // Map„Åã„ÇâÈÖçÂàó„Å´Â§âÊèõ
        tempMap.forEach(value => allKanji.push(value));
        // console.log(allKanji); // Á¢∫Ë™çÁî®

        let currentKanjiList = [];
        let currentKanjiIndex = 0;
        let score = 0;
        let currentGradeName = "";

        const settingsScreen = document.getElementById('settings-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultsScreen = document.getElementById('results-screen');

        const kanjiDisplay = document.getElementById('kanji-display');
        const readingInput = document.getElementById('reading-input');
        const checkButton = document.getElementById('check-button');
        const nextButton = document.getElementById('next-button');
        const feedbackMessage = document.getElementById('feedback-message');
        const scoreDisplay = document.getElementById('score-display');
        const quizTitle = document.getElementById('quiz-title');
        const progressBar = document.getElementById('progress-bar');

        const finalScoreDisplay = document.getElementById('final-score');
        const finalMessageDisplay = document.getElementById('final-message');

        const modal = document.getElementById('custom-message-modal');
        const modalText = document.getElementById('modal-text');
        const modalOkButton = document.getElementById('modal-ok-button');

        function showModal(message) {
            modalText.textContent = message;
            modal.style.display = 'flex';
        }
        modalOkButton.onclick = function() {
            modal.style.display = 'none';
        }
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function startGame(gradeKanji, gradeName) {
            currentGradeName = gradeName;
            currentKanjiList = [...gradeKanji];
            shuffleArray(currentKanjiList);
            currentKanjiIndex = 0;
            score = 0;

            settingsScreen.style.display = 'none';
            resultsScreen.style.display = 'none';
            quizScreen.style.display = 'block';
            quizTitle.textContent = `${gradeName}„ÅÆ „Çà„Åø„Åã„Åü„ÇØ„Ç§„Ç∫ÔºÅ`;

            displayNextKanji();
            updateScoreDisplay();
            updateProgressBar();
        }

        function displayNextKanji() {
            if (currentKanjiIndex < currentKanjiList.length) {
                const kanjiObj = currentKanjiList[currentKanjiIndex];
                kanjiDisplay.textContent = kanjiObj.display; // „Åì„Åì„ÇíÂ§âÊõ¥
                readingInput.value = '';
                feedbackMessage.textContent = '';
                feedbackMessage.className = 'text-center text-lg min-h-[2.5em] mt-2 mb-2';
                readingInput.disabled = false;
                readingInput.focus();
                checkButton.style.display = 'block';
                nextButton.style.display = 'none';
            } else {
                showResults();
            }
        }

        function checkAnswer() {
            const userInput = readingInput.value.trim();
            if (!userInput) {
                showModal("„Çà„Åø„Åå„Å™„Çí „ÅÑ„Çå„Å¶„Åè„Å†„Åï„ÅÑ„Å≠„ÄÇ");
                return;
            }

            const kanjiObj = currentKanjiList[currentKanjiIndex];
            if (kanjiObj.readings.includes(userInput)) {
                feedbackMessage.textContent = '„Åõ„ÅÑ„Åã„ÅÑÔºÅ üéâ';
                feedbackMessage.className += ' feedback-correct';
                score++;
            } else {
                const correctAnswerText = kanjiObj.readings.join('„Äç„Åã„Äå');
                feedbackMessage.textContent = `„Åñ„Çì„Å≠„Çì... „Åü„Å†„Åó„Åè„ÅØ„Äå${correctAnswerText}„Äç„Å†„Çà„ÄÇ`;
                feedbackMessage.className += ' feedback-incorrect';
            }
            readingInput.disabled = true;
            checkButton.style.display = 'none';
            nextButton.style.display = 'block';
            nextButton.focus();
            updateScoreDisplay();
            updateProgressBar();
        }
        
        readingInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                if (checkButton.style.display === 'block') {
                    checkAnswer();
                } else if (nextButton.style.display === 'block') {
                    handleNextButton();
                }
            }
        });

        function handleNextButton() {
            currentKanjiIndex++;
            displayNextKanji();
            updateProgressBar();
        }

        function updateScoreDisplay() {
            scoreDisplay.textContent = `„ÇÇ„Çì„Å†„ÅÑ: ${currentKanjiIndex + 1} / ${currentKanjiList.length}  „Åõ„ÅÑ„Åã„ÅÑ: ${score}`;
        }
        
        function updateProgressBar() {
            const progress = (currentKanjiList.length > 0) ? ((currentKanjiIndex) / currentKanjiList.length) * 100 : 0;
             // currentKanjiIndex „ÅåÊúÄÂæå„Åæ„ÅßË°å„Åè„Å®100%„Å´„Å™„Çã„Çà„ÅÜ„Å´Ë™øÊï¥
            progressBar.style.width = `${Math.min(progress, 100)}%`;
        }

        function showResults() {
            quizScreen.style.display = 'none';
            resultsScreen.style.display = 'block';
            progressBar.style.width = '100%'; // ÁµêÊûúË°®Á§∫ÊôÇ„ÅØ„Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº„Çí100%„Å´„Åô„Çã
            finalScoreDisplay.textContent = `${score} / ${currentKanjiList.length} „ÇÇ„Çì „Åõ„ÅÑ„Åã„ÅÑÔºÅ`;

            let message = "";
            const percentage = currentKanjiList.length > 0 ? (score / currentKanjiList.length) * 100 : 0;
            if (percentage === 100) {
                message = "„Åô„Åî„ÅÑÔºÅ„Åú„Çì„Å∂ „Åõ„ÅÑ„Åã„ÅÑ„Å†ÔºÅ„Åã„Çì„Åò„Éû„Çπ„Çø„Éº„Å†„Å≠ÔºÅü•≥";
            } else if (percentage >= 80) {
                message = "„Çà„Åè„Åß„Åç„Åæ„Åó„ÅüÔºÅ„ÇÇ„ÅÜ„Åô„Åì„Åó„Åß „Åã„Çì„Å∫„Åç„Å†ÔºÅüòä";
            } else if (percentage >= 50) {
                message = "„Åå„Çì„Å∞„Å£„Åü„Å≠ÔºÅ„Å§„Åé„ÅØ „ÇÇ„Å£„Å® „Åõ„ÅÑ„Åã„ÅÑ„Åß„Åç„Çã„ÇàÔºÅüëç";
            } else {
                message = "„Åä„Å§„Åã„Çå„Åï„ÅæÔºÅ„Åæ„Åü „ÉÅ„É£„É¨„É≥„Ç∏„Åó„Å¶„Å≠ÔºÅüí™";
            }
            finalMessageDisplay.textContent = message;
        }

        document.getElementById('grade1-btn').addEventListener('click', () => startGame(kanjiData.g1, '1Âπ¥Áîü'));
        document.getElementById('grade2-btn').addEventListener('click', () => startGame(kanjiData.g2, '2Âπ¥Áîü'));
        document.getElementById('grade-all-btn').addEventListener('click', () => startGame(allKanji, '1„Éª2Âπ¥Áîü„Åú„Çì„Å∂'));
        
        document.getElementById('back-to-settings-btn').addEventListener('click', () => {
            quizScreen.style.display = 'none';
            resultsScreen.style.display = 'none';
            settingsScreen.style.display = 'block';
            progressBar.style.width = '0%'; // Ë®≠ÂÆöÁîªÈù¢„Å´Êàª„Çã„Å®„Åç„Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº„Çí„É™„Çª„ÉÉ„Éà
        });

        checkButton.addEventListener('click', checkAnswer);
        nextButton.addEventListener('click', handleNextButton);

        document.getElementById('restart-quiz-btn').addEventListener('click', () => {
            let gradeToRestart;
            if (currentGradeName === '1Âπ¥Áîü') gradeToRestart = kanjiData.g1;
            else if (currentGradeName === '2Âπ¥Áîü') gradeToRestart = kanjiData.g2;
            else gradeToRestart = allKanji;
            startGame(gradeToRestart, currentGradeName);
        });

        document.getElementById('change-grade-btn').addEventListener('click', () => {
            resultsScreen.style.display = 'none';
            settingsScreen.style.display = 'block';
            progressBar.style.width = '0%'; // Ë®≠ÂÆöÁîªÈù¢„Å´Êàª„Çã„Å®„Åç„Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº„Çí„É™„Çª„ÉÉ„Éà
        });

    </script>
</body>
</html>
